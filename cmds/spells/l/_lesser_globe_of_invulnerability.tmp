#include <spell.h>
#include <daemons.h>
#include <magic.h>
inherit SPELL;

void create() 
{
    ::create();
    set_spell_name("lesser globe of invulnerability");
    set_spell_level(([ "mage" : 4 ]));
    set_spell_sphere("abjuration");
    set_syntax("cast CLASS lesser globe of invulnerability");
    set_description("With this spell, you surround yourself with anti-magic field that disrupts intrinsic connections in the weave, briefly preventing spells of level 3 or less from entering the globe around you. This spell affects only targeted spells.

THIS SPELL IS NOT YET IMPLEMENTED.");
    set_verbal_comp();
    set_somatic_comp();
    set_helpful_spell(1);
}

int preSpell()
{
   if((int)CASTER->query_property("globe_of_invulnerability"))
   {
      tell_object(CASTER,"You are already under the influence of such a spell.");
      return 0;
   }
   return 1;
}

void spell_effect()
{
    tell_object(caster, "%^WHITE%^%^BOLD%^The air around you starts to shimmer, as intrinsic magic field is disrupted by your will!%^RESET%^");
    tell_room(place,"%^WHITE%^%^BOLD%^"+caster->QCN+" is suddenly surrounded by globe of shimmer!%^RESET%^",caster);
    spell_successful();
    addSpellToCaster();
    caster->set_property("globe_of_invulnerability",4);
    call_out("dest_effect",clevel*ROUND_LENGTH);
}

void dest_effect(){
     if(objectp(caster))
     {
      tell_object(caster,"%^BLUE%^The glove of force surrounding you fades.%^RESET%^");
      tell_room(environment(caster),"%^BLUE%^The globe surrounding "+caster->QCN+" fades.%^RESET%^",caster);
      caster->remove_property("globe_of_invulnerability",-1);
    }
    ::dest_effect();
    if(objectp(TO))
        TO->remove();
}

