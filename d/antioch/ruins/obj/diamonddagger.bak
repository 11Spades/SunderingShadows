#include <std.h>

inherit WEAPON;
string OWNER;
void init() {
   ::init();
   if(interactive(TP) && TP==environment(TO) && !OWNER) OWNER = TPQN;
}

void create() {
::create();
   set_id( ({"dagger","diamond dagger","wrath","wrath of heaven","heaven dagger"}) );
   set_obvious_short("diamond tipped dagger");
   set_short("%^BOLD%^%^CYAN%^W%^BOLD%^%^BLUE%^r%^BOLD%^%^CYAN%^ath of %^BOLD%^%^WHITE%^H%^BOLD%^%^YELLOW%^e%^BOLD%^%^WHITE%^aven%^RESET%^");
   set_name("diamond dagger");
   set_long(
      "%^BOLD%^%^CYAN%^A dagger made of flawless steel with a diamond tipped blade. The length"
      " of the dagger is unmarked with any runes, but the tip is set in %^BOLD%^%^WHITE%^glittering%^BOLD%^%^CYAN%^"
      " diamond dust. The hilt is of solid gold and in the shape of a rectangle. The"
      " handle of the weapon follows same theme and is made of solid gold as well, but is"
      " wrapped in many layers of fine Tsarvian silk."
   );
   set_lore(
   "This dagger was created by the wizards, Jancarius Seiryujinn and Mithras and the weaponsmith Tengri Beovule on Lightday 24, Autumnstime 664 SG."+
   "Soon after, the dagger was remade by the Archmage of Antioch Welkanar several times to aid those who are in need of its magic."
   );
set_weight(10);
set_value(2000);
set_wc(1,6);
set_large_wc(1,8);
set_size(1);
set_prof_type("diamond dagger");
set_type("thiefslashing");
set_property("enchantment",3);
   set_wield((:TO,"wield":));
   set_unwield((:TO,"unwield":));
   set_hit((:TO,"hit":));
}

int hit(object targ) {
targ = ETO->query_current_attacker();
   if(random(1000) < 200){
      tell_room(environment(query_wielded()),"%^BOLD%^%^WHITE%^The dagger shimmers quickly as "+ETOQCN+" expertly cuts "+targ->QCN+" across the face, leaving a wound so clean, it does not bleed until seconds later.%^RESET%^",({ETO,targ}));
      tell_object(ETO,"%^BOLD%^%^WHITE%^The dagger shimmers quickly as you expertly cut "+targ->QCN+" across the face, leaving a wound so clean, it does not bleed until seconds later.%^RESET%^");
      tell_object(targ,"%^BOLD%^%^WHITE%^"+ETOQCN+"'s dagger shimmers quickly as you are expertly cut across the face, leaving a wound so clean, it does not bleed until seconds later.%^RESET%^");
   set_property("magic",1);
   targ->do_damage("head",roll_dice(4,12));
   return 1;
}
}

int wield() {
   object tp;
   tp = this_player();
   if (!tp) return 0;
   if((int)TP->query_level() < 25) {
   write("You lack the skill to posses such a weapon.");
   return 0;
   }
   if( (!TP->is_class("thief"))) {
   write("You are not fit to wield such a weapon");
   return 0;
   }
   if(interactive(TP) && (string)TP->query_name() !=OWNER){
   write("This is not your dagger.");
   return 0;
   }
   tp->set_property("magic",1);
   write("%^BOLD%^%^WHITE%^You quietly grip the %^BOLD%^%^YELLOW%^golden%^BOLD%^%^WHITE%^ hilt of the dagger.%^RESET%^");
   ETO->set_property("good item",1);
   return 1;
}

int unwield() {
ETO->set_property("magic",-1);
ETO->set_property("good item",-1);
   return 1;
}
