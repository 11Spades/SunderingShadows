#include <std.h>
inherit "/std/weapon";

create() {
   	::create();
   	set_id(({ "warpgate generator", "generator", "warpgate", "staff" }));
   	set_name("warpgate generator");
   	set_short("A %^MAGENTA%^Warpgate Generator%^RESET%^");
        set_long("
    %^MAGENTA%^This is the Warpgate Generator that was constructed by Autarkis to carry his minions into distant towns to eradicate them.  It is a long staff with a large gold amulet on one end, and a large brass ring on the other.
    %^RESET%^
    USAGE: %^RED%^Open warpgate.
%^BOLD%^This is the generator designed for transport to Shadow.
");
   	set_weight(10);
   	set_size(2);
   	set("value",15000);
   	set_wc(1,8);
   	set_large_wc(1,10);
	set_type("magebludgeon");
   	set_property("enchantment",3);
  	set_wield((:TO,"to_hit":));
        set_hit("%^BOLD%^%^BLUE%^A tiny vortex of light appears and envelops a piece of your opponent's flesh!");
}


int to_hit(){
	if((int)TP->query_level() < 19){
        write("%^BOLD%^This is too difficult a weapon to master for someone with your skills!");
        return 0;
	}
 	return 1;
}
void init() {
  ::init();
  add_action("open", "open");
}
int open(string str) {
    if(environment(this_player())->query_property("no teleport")) { return 0;}
  if(str=="warpgate") {
   if(random(6) > 1){
  write("%^BOLD%^%^BLUE%^You tap your Warpgate Generator against the ground twice.\n");
 say((string)this_player()->query_cap_name()+" taps a long staff against the ground twice.\n");
  this_player()->move_player("/d/attaya/seneca/warpgate1");
  return 1;
    } else {
  write("%^BOLD%^%^RED%^The warpgate generator becomes white hot and explodes in a blinding fireball!\n");
    say("%^BOLD%^%^RED%^"+TPQCN+"'s warpgate generator becomes white hot and explodes in a blinding fireball!\n");
    TP->do_damage("torso", random(50));  
       TO->remove();
    return 0;
       }
    write("You cannot open a warp vortex here!  No teleportation strands intersect at this spacial point along your current plane of reality.");
   return 0;
    }

    return 0;
}
